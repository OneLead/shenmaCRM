angular.module('leader-module',['ngRoute','userInfo','datatablesDirectives','CheckIn'])
    .config(['$routeProvider',function($routeProvider){
        $routeProvider
            .when('/',{
                templateUrl:'/public/templates/leader/taskList.html',
                controller:'taskListCtrl'
            })
            .when('/task/list',{
                templateUrl:'/public/templates/leader/taskList.html',
                controller:'taskListCtrl'
            })
            .when('/task/update/:id',{
                templateUrl:'/public/templates/leader/taskUpdate.html',
                controller:'taskUpdateCtrl'
            });
        $routeProvider
            .when('/sign/list',{
                templateUrl:'/public/templates/leader/signList.html',
                controller:'signListCtrl'
            })
            .when('/sign/detail/:uuid/:name/:type',{
                templateUrl:'/public/templates/leader/signDetail.html',
                controller:'signDetailCtrl'
            });
        $routeProvider
            .when('/project/ranking',{
                templateUrl:'/public/templates/leader/projectRanking.html',
                controller:'rankingCtrl'
            })
            .when('/project/expense',{
                templateUrl:'/public/templates/leader/projectExpense.html',
                controller:'expenseCtrl'
            })
            .when('/project/goals',{
                templateUrl:'/public/templates/leader/projectGoals.html',
                controller:'goalsCtrl'
            })
            .when('/project/leader',{
                templateUrl:'/public/templates/leader/projectLeader.html'
            })
            .when('/project/leaderJump/:code',{
                templateUrl:'/public/templates/leader/projectLeaderJump.html',
                controller:'leaderCtrl'
            });
    }])
    .run(function($rootScope,$document,$http){
        $rootScope.goto = function(name1,name2){
            $document.find('li.item').removeClass('active');
            $document.find('li.'+name1).addClass('active');
            if(name2)$document.find('li.'+name2).addClass('active');
            var $collapse = $document.find('.navbar-collapse');
            $collapse.addClass('collapsing')
                .removeClass('in');
            setTimeout(function(){
                $collapse.removeClass('collapsing');
            },300);
        };
        $rootScope.exit = function(){
            var id = sessionStorage.getItem('sessionID');
            $http({
                url:localStorage.getItem('ip')+'retailer/user/logoff?sessionID='+id,
                method:'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
                }
            }).success(function(){
                location.assign('/');
            });
        };
    });